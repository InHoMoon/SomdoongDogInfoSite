<?xml version="1.0" encoding="UTF-8"?>

<!-- 마이바티스 3 Mapper DTD -->
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
    
<mapper namespace="somdoong.notice.dao.face.NoticeDao">
	
	<select id="selectCntAll" resultType="int">
		SELECT count(*) FROM notice 
	</select>
	
	<select id="selectList" resultType="Notice" parameterType="Paging">
		SELECT * FROM (
			SELECT rownum rnum, N.* FROM (
				SELECT
					notino, adminid, notititle , noticontent
					, notihit, notidate
				FROM notice
				ORDER BY notino DESC
			) N
		) NOTICE
		WHERE rnum BETWEEN #{startNo } AND #{endNo }
	</select>

	<update id="updateNotiHit" parameterType="Notice">
		UPDATE notice
		SET notihit = notihit + 1
		WHERE notino = #{notiNo}
	</update>
	
	<select id="selectNotice" resultType="Notice" parameterType="Notice">
		SELECT
			notino, adminid, notititle , noticontent
					, notihit, notidate
		FROM board
		WHERE notino = #{notiNo}
	</select>
	
	<insert id="insertNotice" parameterType="Notice">
		<selectKey order="BEFORE" resultType="int" keyProperty="notiNo">
			SELECT notice_seq.nextval FROM dual
		</selectKey>
	
		INSERT INTO notice ( notino, adminid, notititle , noticontent )
		VALUES ( #{notiNo }, #{adminId }, #{notiTitle }, #{notiContent } )
	</insert>

	<insert id="insertFile" parameterType="NoticeFile">
		INSERT INTO noticefile ( nfileno, notino, originname, storedname)
		VALUES ( noticefile_seq.nextval, #{notiNo }, #{originName }, #{storedName } )
	</insert>
	
	<select id="selectNoticeFileByNotiNo" resultType="NoticeFile" parameterType="Notice">
		SELECT
			nfileno, notino, originname, storedname
		FROM noticefile
		WHERE notino = #{notiNo }
	</select>
	
	<select id="selectNoticeFileByNFileNo" resultType="NoticeFile" parameterType="NoticeFile">
		SELECT
			nfileno, notino, originname, storedname
		FROM noticefile
		WHERE nfileno = #{nFileNo }
	</select>
	
	<update id="updateNotice" parameterType="Notice">
		UPDATE notice
		SET notititle = #{notititle}
			, noticontent = #{noticontent}
		WHERE notino = #{notiNo}
	</update>
	
	<delete id="deleteFile" parameterType="Notice">
		DELETE noticefile
		WHERE notino = #{notiNo}	
	</delete>
	
	<delete id="delete" parameterType="Notice">
		DELETE notice
		WHERE notino = #{notiNo}	
	</delete>

</mapper>